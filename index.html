<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>æ—¥ä¸­äº’è¯‘ç»ƒä¹  AI ç‚¹è¯„</title>
  <style>
    body {
      font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
      background: #e0f7ec url('https://i.imgur.com/YRYFiCX.jpg') repeat;
      color: #333;
      padding: 20px;
    }
    h1 {
      font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
      color: #2e7d32;
      font-size: 28px;
      margin-bottom: 10px;
      text-align: center;
    }
    label {
      font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
      display: block;
      margin: 12px 0 4px;
      font-weight: bold;
    }
    textarea {
      font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
      width: 100%;
      height: 100px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
      resize: vertical;
    }
    button {
      font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #81c784;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #66bb6a;
    }
    .result {
      font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
      background: #f1f8e9;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid #c5e1a5;
      white-space: pre-wrap;
    }
    .mode-switch {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>ğŸŒ¸ æ—¥ä¸­äº’è¯‘ç»ƒä¹  AI ç‚¹è¯„ ğŸŒ³</h1>

  <div class="mode-switch">
    <label for="mode">è¯·é€‰æ‹©ç¿»è¯‘æ¨¡å¼ï¼š</label>
    <select id="mode">
      <option value="jp_to_cn">æ—¥è¯­ â†’ ä¸­æ–‡</option>
      <option value="cn_to_jp">ä¸­æ–‡ â†’ æ—¥è¯­</option>
    </select>
  </div>

  <label for="source">åŸæ–‡ï¼š</label>
  <textarea id="source" placeholder="è¯·è¾“å…¥åŸæ–‡ï¼ˆæ—¥æ–‡æˆ–ä¸­æ–‡ï¼‰"></textarea>

  <label for="translation">ä½ çš„ç¿»è¯‘ï¼š</label>
  <textarea id="translation" placeholder="è¯·è¾“å…¥ä½ çš„ç¿»è¯‘ï¼ˆä¸­æ–‡æˆ–æ—¥æ–‡ï¼‰"></textarea>

  <button onclick="submitTranslation()">æäº¤ç¿»è¯‘</button>

  <div class="result" id="resultArea" style="display:none;">
    <p><strong>AI ç‚¹è¯„ï¼š</strong><pre id="review"></pre></p>
    <p><strong>æ ‡å‡†è¯‘æ–‡ï¼š</strong><pre id="standard"></pre></p>
    <p><strong>è¯„åˆ†ï¼š</strong><span id="score"></span> / 10</p>
  </div>

  <script>
    const apiKey = "sk-9ee10cfefb794162aa134697b245f0d3";

    // é¡µé¢åŠ è½½æ—¶è¯»å–æœ¬åœ°å­˜å‚¨çš„å†å²
    window.onload = () => {
      const savedMode = localStorage.getItem("mode");
      const savedSource = localStorage.getItem("source");
      const savedTranslation = localStorage.getItem("translation");

      if (savedMode) document.getElementById("mode").value = savedMode;
      if (savedSource) document.getElementById("source").value = savedSource;
      if (savedTranslation) document.getElementById("translation").value = savedTranslation;
    };

    // é¡µé¢å†…å®¹å˜åŒ–æ—¶ä¿å­˜æœ¬åœ°å­˜å‚¨
    ["mode", "source", "translation"].forEach(id => {
      document.getElementById(id).addEventListener("input", () => {
        localStorage.setItem(id, document.getElementById(id).value);
      });
    });

    async function submitTranslation() {
      const source = document.getElementById("source").value.trim();
      const translation = document.getElementById("translation").value.trim();
      const mode = document.getElementById("mode").value;
      const resultArea = document.getElementById("resultArea");

      if (!source || !translation) {
        alert("è¯·å¡«å†™åŸæ–‡å’Œä½ çš„ç¿»è¯‘ï¼");
        return;
      }

      const prompt = `
è¯·ä½œä¸ºä¸“ä¸šçš„æ—¥ä¸­ç¿»è¯‘ä¸“å®¶ï¼Œä»ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢å¯¹ç”¨æˆ·çš„ç¿»è¯‘è¿›è¡Œç‚¹è¯„ï¼š

1. æœ‰æ— æ¼è¯‘å’Œè¯¯è¯‘ï¼Œè¯­æ³•ä»¥åŠå•è¯æ˜¯å¦æœ‰é”™è¯¯ï¼›
2. å¥å­æ˜¯å¦æµç•…è‡ªç„¶ï¼›
3. è¡¨è¾¾æ˜¯å¦åœ°é“ã€‚

è¯·æ ¹æ®ä»¥ä¸‹å†…å®¹ç»™å‡ºç‚¹è¯„ï¼Œå¹¶é™„ä¸Šæ ‡å‡†è¯‘æ–‡å’Œæ»¡åˆ†10åˆ†çš„è¯„åˆ†ã€‚

ç¿»è¯‘æ–¹å‘ï¼š${mode === "jp_to_cn" ? "æ—¥æ–‡ â†’ ä¸­æ–‡" : "ä¸­æ–‡ â†’ æ—¥æ–‡"}

åŸæ–‡ï¼š
${source}

ç”¨æˆ·ç¿»è¯‘ï¼š
${translation}

è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›ï¼š
ç‚¹è¯„ï¼š
1. æœ‰æ— æ¼è¯‘å’Œè¯¯è¯‘ï¼Œè¯­æ³•åŠå•è¯é”™è¯¯ï¼š
2. å¥å­æµç•…è‡ªç„¶ç¨‹åº¦ï¼š
3. è¡¨è¾¾åœ°é“ç¨‹åº¦ï¼š

æ ‡å‡†è¯‘æ–‡ï¼š
è¯„åˆ†ï¼š
`;

      document.getElementById("review").textContent = "AI æ­£åœ¨åˆ†æä¸­...";
      document.getElementById("standard").textContent = "è¯·ç¨å€™...";
      document.getElementById("score").textContent = "";

      try {
        const response = await fetch("https://api.deepseek.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + apiKey
          },
          body: JSON.stringify({
            model: "deepseek-chat",
            messages: [{ role: "user", content: prompt }],
            temperature: 0.7
          })
        });

        const data = await response.json();
        const content = data.choices?.[0]?.message?.content || "æœªèƒ½è·å–å›å¤";

        // æå–è¯„åˆ†
        const scoreMatch = content.match(/è¯„åˆ†[:ï¼š]\s*([0-9]+(?:\.[0-9]+)?)/);
        // æå–æ ‡å‡†è¯‘æ–‡
        const standardMatch = content.match(/æ ‡å‡†è¯‘æ–‡[:ï¼š]\s*([\s\S]*?)(?:ç‚¹è¯„|è¯„åˆ†|$)/);
        // ç‚¹è¯„éƒ¨åˆ†å‰¥ç¦»æ ‡å‡†è¯‘æ–‡å’Œè¯„åˆ†ï¼Œæ˜¾ç¤ºå…¨éƒ¨
        const reviewStart = content.indexOf("ç‚¹è¯„ï¼š");
        const standardStart = content.indexOf("æ ‡å‡†è¯‘æ–‡ï¼š");
        let reviewText = "";
        if (reviewStart !== -1 && standardStart !== -1) {
          reviewText = content.substring(reviewStart + 3, standardStart).trim();
        } else {
          reviewText = content;
        }

        document.getElementById("review").textContent = reviewText || "æ— ç‚¹è¯„å†…å®¹";
        document.getElementById("standard").textContent = standardMatch ? standardMatch[1].trim() : "æ— æ ‡å‡†è¯‘æ–‡";
        document.getElementById("score").textContent = scoreMatch ? scoreMatch[1] : "æ— è¯„åˆ†";

        resultArea.style.display = "block";

      } catch (error) {
        console.error(error);
        document.getElementById("review").textContent = "AI ç‚¹è¯„å¤±è´¥";
        document.getElementById("standard").textContent = "æ— æ ‡å‡†è¯‘æ–‡";
        document.getElementById("score").textContent = "æ— è¯„åˆ†";
        resultArea.style.display = "block";
      }
    }
  </script>
</body>
</html>
