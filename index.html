<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>日中互译练习</title>
  <style>
    body {
      font-family: "Helvetica", "Arial", sans-serif;
      background: #e0f7ec url('https://i.imgur.com/YRYFiCX.jpg') repeat;
      color: #333;
      padding: 20px;
    }

    h1 {
      color: #2e7d32;
      font-size: 28px;
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin: 12px 0 4px;
    }

    textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }

    button {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 18px;
      background-color: #81c784;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
      background-color: #66bb6a;
    }

    .result {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      border: 1px solid #ccc;
    }

    .mode-switch {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>日中互译 AI 练习</h1>

  <div class="mode-switch">
    <label for="mode">请选择模式：</label>
    <select id="mode">
      <option value="jp_to_cn">日译中</option>
      <option value="cn_to_jp">中译日</option>
    </select>
  </div>

  <label for="source">原文：</label>
  <textarea id="source" placeholder="请输入原文（日文或中文）"></textarea>

  <label for="translation">你的翻译：</label>
  <textarea id="translation" placeholder="请输入你的翻译（中文或日文）"></textarea>

  <button onclick="submitTranslation()">提交翻译</button>

  <div class="result">
    <p><strong>AI 点评：</strong><span id="review">（等待中...）</span></p>
    <p><strong>标准译文：</strong><span id="standard">（等待中...）</span></p>
    <p><strong>翻译评分：</strong><span id="score">（等待中...）</span></p>
  </div>

  <script>
    const apiKey = "sk-9ee10cfefb794162aa134697b245f0d3";

    async function submitTranslation() {
      const source = document.getElementById("source").value.trim();
      const translation = document.getElementById("translation").value.trim();
      const mode = document.getElementById("mode").value;

      if (!source || !translation) {
        alert("请填写原文和翻译");
        return;
      }

      const prompt = `
请作为专业日中翻译专家，针对以下内容进行点评与建议，并给出标准译文与评分（满分10分）：
翻译方向：${mode === "jp_to_cn" ? "日文 → 中文" : "中文 → 日文"}

原文：
${source}

用户翻译：
${translation}

请按以下格式返回：
点评：……
标准译文：……
评分：……
`;

      document.getElementById("review").textContent = "AI 正在分析中...";
      document.getElementById("standard").textContent = "请稍候...";
      document.getElementById("score").textContent = "评估中...";

      try {
        const res = await fetch("https://api.deepseek.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + apiKey
          },
          body: JSON.stringify({
            model: "deepseek-chat",
            messages: [{ role: "user", content: prompt }],
            temperature: 0.7
          })
        });

        const data = await res.json();
        const content = data.choices?.[0]?.message?.content || "未能获取回复";

        const reviewMatch = content.match(/点评[:：](.+?)\n/);
        const standardMatch = content.match(/标准译文[:：](.+?)\n/);
        const scoreMatch = content.match(/评分[:：](.+?)\n?/);

        document.getElementById("review").textContent = reviewMatch?.[1]?.trim() || "无";
        document.getElementById("standard").textContent = standardMatch?.[1]?.trim() || "无";
        document.getElementById("score").textContent = scoreMatch?.[1]?.trim() || "无";

      } catch (error) {
        console.error(error);
        document.getElementById("review").textContent = "AI 点评失败";
        document.getElementById("standard").textContent = "无";
        document.getElementById("score").textContent = "无";
      }
    }
  </script>
</body>
</html>
